# Doc2Graph: a Task Agnostic Document Understanding Framework based on Graph Neural Networks

ECCV 2022

## 1 背景

​	几何深度学习最近在包括文档分析在内的广泛的机器学习领域引起了极大的兴趣。图神经网络( Graph Neural Networks，GNNs )的应用在各种与文档相关的任务中变得至关重要，因为它们可以揭示重要的结构模式，这些模式是关键信息提取过程中的基础。文献中的先前工作提出了任务驱动模型，并没有考虑到图的全能性。我们提出了一个基于GNN模型的任务无关文档理解框架Doc2Graph来解决给定不同类型文档的不同任务。我们在两个具有挑战性的数据集上评估了我们的方法，用于表单理解、发票布局分析和表格检测中的关键信息提取。

图表示能够鲁棒的表示对象和关系。

预训练模型消耗计算资源和训练时间。



## 2 模型

### 2.1 图像转为图结构

​    graph 由 nodes 和 edges 组成，在文档中，将文本作为结点，将文本之间的关系作为边。

​    如果连接两个位置的线段不通过任何障碍物，则在图中在它们之间绘制一条边。

通常使用启发式方法建图，例如 visibility graph 但是这存在以下问题：

1. 不能很好的适用于不同的布局
2. 过度依赖于结点的检测，即 OCR
3. bounding box 划分不当，会导致失去正确结点，或者增加错误结点
4. 可能预先排除了答案

​	为了避免以上问题，因此本文不对连通性做任何先验假设，建立一个全连通图，然后让网络自己学习应该连接什么关系。

​	

​	文档中可以被利用的信息有：视觉，文本，布局。在本文中，包括以下内容：

1. 用语言模型 **spacy** 去解码文本，获得词或实体的向量表征
2. 用 visual encoder 去表示 样式和格式，在数据集上预训练一个 U-Net 用于实体分割，因为 U-Net 使用不同编码器层的特征图 （feature maps）来分割图像，本文将所有这些信息用作视觉特征。对每个特征图，使用 RoI 对齐层来提取与每个实体 bounding box 相关的特征
3. 绝对位置：对象在文档内的绝对标准化位置，布局和结构在文档中，是很重要的信息



为了建立边，提出两组新的特征及和来帮助结点和边的分类任务：

1. 两个结点的标准欧几里得距离，两个 boundding box 的最小距离，对于全连通图，在用于保持局部性属性的聚合结点函数至关重要
2. 极坐标系下的相对坐标位置，每个源结点被考虑在笛卡尔平面中心，它所有邻结点都通过距离和角度进行编码，（独热编码）将离散化为一些格子，可以选择数量，而不是使用标准化角度，因为连续的角度表示是困难的，例如，两个相同距离角度分别为360°和0°的点，将会被不同地编码。





### 2.2 模型

![image-20230612192413131](note_images\image-20230612192413131.png)



充分利用四个部分

> Input Projector 输入投影
>
> ​	由于模型应用了许多全连接层，因为该模型有许多模态，将他们的每个表示投影到同一纬度的内部空间。将地位几何特征和高维视觉特征结合起来效果提升不大。
>
> 





> GNN Layer
>
> ​	使用 GraphSAGE，使用全连接图，并重定义聚合策略
> $$
> h_{N(i)}^{l+1}=aaggregate(\{  h_j^l,\forall j\in N(i) \})
> $$
> 在层 $l$ 给一个结点 $i$, $h_i$ 是它的内部表示
>
> 对于文档，图结构并不能直接从数据中得到，因此需要重定义以上等式：
> $$
> h_{N(i)}^{l+1}=\frac{c}{|\Upsilon(i)|}\sum_{j\in \Upsilon(i)}h_j^l \\
> \Upsilon(i)=\{j \in N(i):|i-j|<\text { threshold }\}
> $$
> $|i-j|$ 是两个结点的欧几里得距离，距离被标准化为 [0,1] 之间。
>
> $c$ 是一个常数。



> Node Predictor
>
> ​	全连接层（FC），将每个结点的表示映射为目标类的个数
>
> 



> Edge Predictor
>
> ​	两个全连接层，为每条边分配一个标签，并对于边提出新的聚合策略
>
> 一条边是一个三元组 (src, e, dst)，e 是连接结点 src 和 dst 的边
> $$
> h_{e}=h_{s r c}\left\|h_{d s t}\right\| c l s_{s r c}\left\|c l s_{d s t}\right\| e_{p o l a r}
> $$
> $h_e$ 被喂进两个全连接层。$||$ 是 concat 操作
>
> $h_{src}$ 和 $h_{dst}$ 是最后一层 GNN 层的结点 embedding 输出，$cls_{src}$ 和 $cls_{dst}$ 是先前的 node predictor层 经过 softmax 输出的 logits。
>
> 边的相对位置比点的相对位置更好
>
> 如果考虑的任务还包括节点的分类，它们的类可能有助于边的分类，例如在形式上，它不应该找到一个答案连接到另一个答案。
>
> ​	图可以是有向的也可以是无向的，无向边可以用两条有向边表示。
>
> 上式对顺序是无关紧要的，因此可以重新表示为：
> $$
> h_{e}=(h_{s r c}+ h_{d s t})|| c l s_{s r c}\left\|c l s_{d s t}\right\| e_{p o l a r}
> $$



​	



​	





